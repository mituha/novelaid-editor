# 小説執筆エディター 内部仕様書

## 1. アーキテクチャ概要
本アプリケーションは Electron + React (Typescript) で構成されています。
レンダリングプロセス（React）とメインプロセス（Electron）は `preload.ts` を介して IPC (Inter-Process Communication) で通信します。

### 技術スタック
- **Frontend**: React 19, TypeScript, Sass, CSS Modules
- **Editor**: Monaco Editor (@monaco-editor/react)
- **Framework**: Electron
- **Build Tool**: Webpack

## 2. ディレクトリ構造 (Src)
- `main/`: Electronメインプロセス
    - `main.ts`: アプリケーションのエントリーポイント、IPCハンドラー定義
    - `preload.ts`: レンダラーへのIPCブリッジ公開
- `renderer/`: Reactレンダリングプロセス
    - `components/`: UIコンポーネント
        - `Editor/`: Monaco Editor関連
        - `Sidebar/`: ファイルエクスプローラー
    - `layouts/`: 画面レイアウト (`MainLayout`)

## 3. IPC インターフェース
レンダラープロセスは `window.electron.ipcRenderer.invoke(channel, ...args)` を通じて以下の機能を利用できます。

| チャンネル名 | 引数 | 戻り値 | 説明 |
| --- | --- | --- | --- |
| `dialog:openDirectory` | なし | `Promise<string | null>` | フォルダ選択ダイアログを開き、選択されたパスを返す |
| `fs:readDirectory` | `path: string` | `Promise<FileNode[]>` | 指定パスのディレクトリ内ファイル一覧を返す |
| `fs:readFile` | `path: string` | `Promise<string>` | 指定パスのファイル内容をテキストとして読み込む |
| `fs:writeFile` | `path: string, content: string` | `Promise<void>` | 指定パスにテキスト内容を書き込む |
| `project:load` | `path: string` | `Promise<LoadedProject \| null>` | 指定パスからプロジェクト設定とプラグイン情報を読み込む |

### データ構造: `FileNode`
```typescript
interface FileNode {
  name: string;      // ファイル/ディレクトリ名
  isDirectory: boolean; // ディレクトリかどうか
  path: string;      // 絶対パス
}
interface FileNode {
  name: string;      // ファイル/ディレクトリ名
  isDirectory: boolean; // ディレクトリかどうか
  path: string;      // 絶対パス
}

interface LoadedProject {
  config: ProjectConfig;
  plugins: PluginManifest[];
}
```

## 4. プロジェクト構造 (.novelaid)
各プロジェクトフォルダには `.novelaid` フォルダを含めることができ、設定やプラグインを格納します。

```text
ProjectRoot/
└── .novelaid/
    ├── config.json          # プロジェクト固有の設定
    └── plugins/             # プロジェクト固有のプラグイン
        ├── plugin-id-a/     # プラグインフォルダ
        │   ├── manifest.json # プラグイン定義
        │   └── index.js      # 実装コード
        └── ...
```

## 4. コンポーネント詳細

### `MainLayout`
- アプリケーションのメインレイアウト。
- `Sidebar` と `CodeEditor` を保持。
- **State**:
    - `filePath`: 現在開いているファイルのパス
    - `fileContent`: 現在のエディターの内容
- **責務**: ファイル選択時の状態更新、保存ショートカット(`Ctrl+S`)のハンドリング。

### `FileExplorer` (`Sidebar`)
- ディレクトリツリーを表示。
- **機能**:
    - 「フォルダを開く」ボタンでルートディレクトリを設定。
    - ファイルクリックで `onFileSelect` コールバックを発火。
    - (予定) サブディレクトリの展開・折りたたみ。

### `CodeEditor` (`Editor`)
- Monaco Editor のラッパーコンポーネント。
- **Props**:
    - `value`: エディターのテキスト
    - `onChange`: テキスト変更時のコールバック
- **設定**:
    - テーマ: `vs-dark`
    - フォント: Yu Gothic, Meiryo
    - ワードラップ: On

## 5. セキュリティ
- `nodeIntegration: false`, `contextIsolation: true` を設定し、セキュリティを確保。
- CSP (Content Security Policy) により、許可されたスクリプトのみ実行（Monaco Editor用のCDN、Blob等を許可）。
