# AI コンテキスト選択コントロール仕様書

AI チャット（サイドパネルおよびチャットチャンネル）において、AI が参照するコンテキスト（ドキュメント情報）をユーザーが直感的に選択・管理するためのコントロールに関する仕様です。

## 概要

AI との会話に含める情報を、「現在開いているもの」から「特定の任意ファイル」まで柔軟に指定できるようにします。既存の `includeContext` チェックボックスを高度なセレクターに置き換え、または拡張する形で実装します。

## 主な機能

### 1. アクティブドキュメントのクイック選択
- **左ペインのアクティブドキュメント**: チェックボックスで含めるかどうかを選択。ファイル名を表示。
- **右ペインのアクティブドキュメント**: 同上。ファイル名を表示。
- 分割表示されていない場合は、現在アクティブなドキュメントのみを表示。

### 2. オープン中のドキュメントの一括管理
- **「非アクティブな開いているドキュメントも含める」オプション**: 現在タブとして開いているがアクティブではないすべてのドキュメントをコンテキストに含める。

### 3. カスタムコンテキスト（任意ファイルの追加）
- **ドラッグ&ドロップ**: ファイルエクスプローラーから任意のファイルをコントロールにドロップすることで、コンテキストに追加。
- **リスト表示**: 追加されたカスタムファイルのリストを表示。
- **解除（削除）**: 各カスタムファイルの横にある削除ボタンで、リストから除外。

## UI 構成案

```text
[ ] コンテキストを選択
 ├─ [x] 左: 章1.md (アクティブ)
 ├─ [ ] 右: 章2.md (アクティブ)
 ├─ [ ] その他の開いているタブも含める
 └─ カスタムファイル (ここにファイルをドロップ)
     ├─ 設定資料.md [×]
     └─ プロット.txt [×]
```

- コンパクトな表示（アコーディオン形式など）を基本とし、詳細設定を展開できるようにします。

## データ構造

```typescript
interface AIContextSettings {
  includeLeftActive: boolean;
  includeRightActive: boolean;
  includeAllOpen: boolean;
  customPaths: string[]; // ドラッグ&ドロップで追加されたパス
  // 必要に応じて
  excludePaths: string[]; // 個別に除外したい場合
}
```

## 実装上の考慮事項

- **共通コンポーネント化**: `src/renderer/components/AI/AIContextSelector.tsx` として作成し、`AIChatPanel.tsx` と `ChView.tsx` の両方で利用。
- **ドラッグ&ドロップ対応**: React のドラッグ&ドロップ API または HTML5 DND を使用。ファイルパスを受け取る。
- **コンテキスト生成ロジック**: `AIService` に渡す前に、選択されたすべてのパスから内容を取得するロジックを共通化。
- **永続化**: チャットチャンネル（`.ch`）の場合は、そのファイルごとにコンテキスト設定を保存できるのが望ましい。

## 今後の拡張（任意）
- 行番号指定や、ドキュメントの特定の部分のみをコンテキストに含める機能。
- 文字数制限（トークン制限）の警告表示。
