# リファクタリングメモ

バイブコーディングで書かせているため、あちこち問題がある場合の修正用のメモ。


MainLayoutの`tabContents`の名称を`documents`に変更等。
```TypeScript
  const [documents, setDocuments] = useState<
    Record<
      string,
      {
        content: string;
        metadata: Record<string, any>;
        lastSource?: 'user' | 'external';
        initialLine?: number;
        initialColumn?: number;
        searchQuery?: string;
        language?: string;
        deleted?: boolean;
      }
    >
  >({});
```

このソフトの場合、ベースとなるのは読み込まれるドキュメントとなる。
また、タブの管理においても左右分割でも同一のドキュメントは同じものを指す。

タブ自体は別途`Tab[]`で管理されているので、`doccuments`で問題ない。
どのタブで開かれているかの情報等を`document`に含めて参照カウント的な扱いをしたほうが良いかも。
AIチャット部分の構造変更において、内部的にはファイルを参照するため、`documents`に含めたい。

アクセス可能範囲を考えるとDocumentContextで管理した方が良いかも？

MainLayoutのドキュメント領域の左右のタブ部分をコンポーネントにまとめる。

LeftPane、RightPaneにpropsで渡しているのは内部で扱うパネルに依存している。
別な渡し方を検討する。

