# 文章校正仕様書

AIを使用しない、ローカルでの形態素解析およびtextlintによる文章校正機能の仕様。

## 概要

`kuromoji.js` 等のローカルで動作する形態素解析ライブラリと、プラガブルな文章校正ツールである `textlint` を使用し、執筆中の小説の校正支援を行う。
AI（LLM）とは異なり、ルールベースで高速かつオフラインで動作し、確実な指摘を行うことを目的とする。

## UI仕様

### 校正パネル (Calibration Panel)

- リーディングバー（サイドバー）に「校正」アイコンを追加。
- クリックすると右ペイン（または左ペイン、設定により可変）に校正パネルを表示。
- パネル内には以下のタブまたはセクションを設ける。
    1.  **頻出語句 (Frequency)**
    2.  **文章チェック (Inspection)** - textlintを含む
    3.  **表記ゆれ (Consistence)**

## 機能詳細

### 1. 頻出語句リストアップ (Frequency Analysis)

*(既存機能)*
- **目的**: 同じ単語の使いすぎを防ぐ、文章の癖を把握する。
- **機能**:
    - 文章全体（または選択範囲）の形態素解析を行い、品詞ごとに頻出単語をリストアップ。
    - **フィルター**: 名詞、動詞、形容詞、形容動詞、副詞などでフィルタリング可能。
    - **表示**: 単語と出現回数をリスト表示。クリックするとエディター内の該当箇所を検索・ハイライト（順次移動）。

### 2. 文章チェック (Sentence Inspection)

`textlint` および独自のルールベースチェックを使用。

- **textlintによるチェック**:
    - **`textlint-rule-preset-ja-spacing`**:
        - 全角半角のスペース使い分け、疑問符感嘆符の後のスペースなどをチェック。
    - **`textlint-rule-no-dropping-the-ra`**:
        - ら抜き言葉の検出。
    - **`textlint-rule-no-doubled-joshi`**:
        - 助詞の連続使用（一文に同じ助詞が複数回出現）を検出。
- **独自実装チェック (Legacy/Specific)**:
    - **こそあど言葉の過多**:
        - 指示語（これ、それ、あれ、どれ）の多用をチェック。
    - **文末の重複**:
        - 文末（「〜た」「〜だ」など）が連続している箇所を検出。

### 3. 表記ゆれ・漢字の開きチェック (Consistency & Kanji Usage)

- **表記ゆれ**:
    - 同一と思われる単語で、表記が異なるものを検出。
    - 例: 「子供」と「子ども」、「バイオリン」と「ヴァイオリン」。
- **漢字の開き（Open/Close）チェック**:
    - 本来ひらがなで書くべき副詞や形式名詞が漢字で書かれている場合、またはその逆を指摘。

### 4. エディター連携 (Editor Integration)

- **リアルタイム表示**:
    - 校正パネルを開いている間、問題箇所にエディター上で波線（Decoration）を表示。
    - textlintの指摘も同様に表示する。
- **ホバー表示**:
    - 波線箇所をホバーすると、指摘内容を表示。
- **ジャンプ機能**:
    - パネルのリスト項目をクリックすると、エディターの該当箇所へスクロール・フォーカス。

## 技術スタック

- **形態素解析エンジン**: `kuromoji.js`
- **校正ツール**: `textlint` (Browser/Node compatible)
    - ルールプリセット: `textlint-rule-preset-ja-spacing`, `textlint-rule-no-dropping-the-ra`, `textlint-rule-no-doubled-joshi`
- **実装場所**:
    - メインプロセス (`CalibrationService`) で解析を実行し、結果をレンダラーへ送信。

## データ構造（案）

```typescript
interface CalibrationIssue {
  id: string;
  type:
    | 'particle_repetition'
    | 'word_frequency'
    | 'consistency'
    | 'kanji_open_close'
    | 'textlint'; // Added textlint type
  message: string;
  range: {
    startLine: number;
    startColumn: number;
    endLine: number;
    endColumn: number;
  };
  suggestion?: string; // 置換候補
  source?: string; // ルール名など (e.g., "textlint-rule-no-dropping-the-ra")
}
```
