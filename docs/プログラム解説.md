# プログラム解説

## 1. プロジェクト概要
Electron + React + TypeScript で構築された、デスクトップ向け小説執筆支援アプリケーション（Novelagent）。
ベーステンプレートとして `electron-react-boilerplate` (ERB) を使用しています。

## 2. 技術スタック
- **Core**: Electron (v35)
- **Frontend**: React (v19)
- **Language**: TypeScript
- **Bundler**: Webpack
- **Styles**: CSS / SASS

## 3. ディレクトリ構造
- `src/main`: Electronのメインプロセス（バックエンド的な役割）
  - `main.ts`: アプリケーションのエントリーポイント。ウィンドウ作成、ライフサイクル管理、IPCリスナー設定など。
  - `preload.ts`: レンダラープロセスにセキュアに機能を公開するためのブリッジスクリプト（Context Bridge）。
- `src/renderer`: レンダラープロセス（Reactフロントエンド）
  - `index.tsx`: Reactのエントリーポイント。
  - `App.tsx`: アプリケーションのルートコンポーネント、ルーティング設定。
  - `layouts`: 画面全体のレイアウト（例: `MainLayout`）。
  - `components`: 再利用可能なUIコンポーネント（例: `Editor`, `Sidebar`）。
- `.erb`: ビルド設定（Webpack等）が格納されています。

## 4. データフローとアーキテクチャ
本アプリは Electron のセキュリティベストプラクティスに従い、`Context Isolation`（コンテキストの分離）が有効になっています。
レンダラープロセス（React側）からファイルシステムへの直接アクセスは制限されており、メインプロセス（Node.js環境）を経由して操作を行います。

### IPC通信 (Inter-Process Communication)
`src/main/preload.ts` で定義された `electronHandler` を通じて、検証済みのAPIのみが `window.electron.ipcRenderer` としてグローバルに公開されています。

**主なAPIメソッド:**
- **invoke(channel, ...args)**: メインプロセスへリクエストを送り、結果をPromiseで受け取ります（Request-Response）。
- **sendMessage(channel, ...args)**: メインプロセスへ一方的にメッセージを送ります。
- **on(channel, callback)**: メインプロセスからのメッセージを受信します。

**実装済みのチャンネル:**
- `fs:readFile`: ファイル内容の読み込み
- `fs:writeFile`: ファイルへの保存
- `fs:readDirectory`: ディレクトリ内容の取得
- `dialog:openDirectory`: フォルダ選択ダイアログの表示

## 5. 開発環境のセットアップ
1. **依存関係のインストール**:
   ```pwsh
   npm install
   ```
2. **開発サーバーの起動**:
   ```pwsh
   npm start
   ```
   コマンド実行後、Electronアプリが起動します。ソースコードを変更すると自動的にリロードされます（HMR）。

## 6. 新機能追加のガイドライン
UIコンポーネントを追加し、Node.jsの機能（ファイル操作など）が必要な場合は以下の手順を踏みます。

1. **メインプロセスの実装 (`src/main/main.ts`)**:
   `ipcMain.handle` または `ipcMain.on` を使用して、機能の実装を追加します。
2. **Preload定義 (`src/main/preload.ts`)**:
   `Channels` 型定義に新しいチャンネル名を追加し、許可リストに登録します。
3. **レンダラーでの利用 (`src/renderer/**/*.tsx`)**:
   `window.electron.ipcRenderer` を経由して機能を呼び出します。
