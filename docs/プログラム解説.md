# プログラム解説

## 1. プロジェクト概要
Electron + React + TypeScript で構築された、デスクトップ向け小説執筆支援アプリケーション（novelaid）。
エクスプローラー、履歴管理（Git）、AI支援（LM Studio等）を統合した執筆環境を提供します。

## 2. 技術スタック
- **Core**: Electron
- **Frontend**: React 19
- **Language**: TypeScript
- **Styles**: CSS (Vanilla CSS)
- **Icons**: Lucide React

## 3. ディレクトリ構造
- `src/main`: Electronのメインプロセス
  - `main.ts`: エントリーポイント。IPCリスナー設定、ウィンドウ管理。
  - `launcher.ts`: 最近使ったプロジェクトのJSON保存・読み込み。
  - `git/`: `simple-git` を使用したGit操作の抽象化。
  - `ai/`: 各種AIプロバイダー（Google Gemini, OpenAI, LM Studio）のファクトリーと実装。
  - `preload.ts`: レンダラーに公開するAPI定義。
- `src/renderer`: レンダラープロセス（React）
  - `App.tsx`: ルーティング（Library vs Editor）と全グローバルContextの配置。
  - `contexts/`: アプリ全体の共通状態管理。
    - `SettingsContext.tsx`: 設定の永続化と、設定画面の制御。
    - `GitContext.tsx`: Gitのステータスと履歴の保持。
    - `PanelContext.tsx`: 両サイドパネルの表示管理。
  - `layouts/MainLayout.tsx`: 執筆画面のメインレイアウト。
  - `components/`: UIコンポーネント。機能ごとにフォルダ分け。

## 4. データフローとアーキテクチャ

### 状態管理
本アプリでは React Context を活用して機能を疎結合に保っています。
- 各機能（Git, AI等）は専用の Context を通じて React コンポーネントに機能を提供します。
- データの変更（保存、設定更新等）はメインプロセス側の IPC ハンドラーを呼び出すことで実行されます。

### IPC通信
`src/main/preload.ts` で定義された `electronHandler` を通じて通信します。
主要な機能群は以下の通りです：
- `fs:*`: ファイルシステムの操作。
- `git:*`: リポジトリ操作。
- `ai:*`: 生成AIの利用（メッセージ送受信、ストリーミング）。
- `recent:*`: プロジェクト履歴。

## 5. 開発の基本フロー
1. **メインプロセスの機能追加**: `src/main/` 配下にロジックを実装し、`main.ts` で IPC ハンドラーを登録。
2. **Preload定義**: `src/main/preload.ts` にチャンネルを追加。
3. **Context / Component の実装**: レンダラー側で `window.electron.ipcRenderer` を呼び出す処理を実装。

## ソフトの流れ

//TODO 起動からの処理を記載

## 開発中のみの機能
開発ツールは開発中のみ起動時に表示されます。
//TODO どこで切り替えている？

開発ツールのトグルメニューも開発中のみの機能となっています。
```typescript
//src/main/menu.ts
    const subMenuView =
      process.env.NODE_ENV === 'development' ||
      process.env.DEBUG_PROD === 'true'
        ? subMenuViewDev
        : subMenuViewProd;
```
でメニュー自体を切り替えています。

  