# プラグイン仕様書

novelaid は、プロジェクトごとの `.novelaid` フォルダ内に配置することで機能を拡張できるプラグインシステムを提供しています。

## 1. ディレクトリ構造

各プラグインは `.novelaid/plugins/` ディレクトリ配下に、固有のIDを持つフォルダとして配置します。

```text
ProjectRoot/
└── .novelaid/
    ├── config.json          # プロジェクト設定（自動生成）
    └── plugins/
        ├── my-custom-plugin/  # プラグインID
        │   ├── manifest.json  # プラグイン定義ファイル
        │   ├── index.js       # エントリーポイント（レンダラープロセス用）
        │   └── styles.css     # (任意) スタイルシート
        └── another-plugin/
            └── ...
```

## 2. マニフェストファイル (manifest.json)

プラグインのメタデータを定義する必須ファイルです。

```json
{
  "id": "my-custom-plugin",
  "name": "My Custom Plugin",
  "version": "1.0.0",
  "description": "プラグインの説明文",
  "main": "index.js",
  "permissions": []
}
```

- **id**: プラグインを一意に識別するID。フォルダ名と一致させることを推奨します。
- **name**: 設定画面などに表示されるプラグイン名。
- **main**: エントリーポイントとなるJavaScriptファイル（現在はレンダラープロセスで実行されます）。

## 3. プラグインAPI (Renderer Process)

プラグインは `window.novelaid` (予定) または提供される Context API を通じてアプリケーションと対話します。
現在は以下の機能が実装されています。

### 設定画面へのタブ追加 (`SettingsContext`)

プラグインからアプリケーションの設定画面に独自のタブを追加できます。

```typescript
// 設定タブのインターフェース
interface SettingsTab {
  id: string;
  name: string;
  render: () => JSX.Element; // Reactコンポーネント
}

// 利用例 (Concept)
// プラグインが SettingsContext を利用できる形でロードされる必要があります。
// 現時点ではアプリ内コンポーネントとしての実装例のみ存在します。
```

> [!NOTE]
> 現在のアルファ版では、外部JSファイルの動的ロードとReactコンテキストへのアクセス機構は開発中です。
> 今後のアップデートで `window.novelaid.registerSettingTab({...})` のようなAPIが公開される予定です。

## 4. 開発ロードマップ

現在のプラグインシステムは初期段階です。以下の機能が順次追加される予定です。

- [ ] 外部プラグインスクリプトの動的ロード (`vm` または `<script>` タグ)
- [ ] プラグイン向け API ブリッジ (`window.novelaid`) の公開
- [ ] メインプロセス（バックエンド）側の機能拡張 API
- [ ] スタイルの分離と適用
